# 🤖 cTrader DCA Calculator

> **DCA定期定额投资计算器** - 专业的cTrader DCA cBot参数优化与风险分析工具

[![技术栈](https://img.shields.io/badge/技术栈-Vue%203%20+%20JavaScript-4FC08D?style=flat-square)](https://vuejs.org/)
[![语言](https://img.shields.io/badge/语言-JavaScript%2052.4%25%20%7C%20HTML%2025%25%20%7C%20CSS%2022.6%25-brightgreen?style=flat-square)](#)
[![许可证](https://img.shields.io/badge/许可证-MIT-blue?style=flat-square)](#)

## 📖 项目简介

cTrader DCA Calculator 是一个专门为 cTrader 平台设计的DCA（Dollar Cost Averaging，定期定额投资）策略参数优化工具。通过精确的数学模型和直观的可视化界面，帮助交易者分析DCA策略的风险收益特征，优化cBot参数设置。

### 🎯 核心价值

- **参数优化**：智能分析DCA间距、仓位倍数等关键参数的最优配置
- **风险控制**：精确计算最大回撤、保证金占用、仓位风险等关键指标  
- **策略验证**：通过数学模型验证DCA策略在不同市场条件下的表现
- **决策支持**：提供专业的风险建议和参数调整建议

## ✨ 功能特性

### 🎛️ 参数配置系统
- **DCA间距设置**：支持1-1000点的灵活间距配置
- **仓位管理**：首次仓位手数、仓位倍数指数精确控制
- **风险边界**：最大仓位数、预期最大回撤点数限制
- **价值计算**：每点价值自定义，适配不同交易品种

### 📊 风险分析引擎
- **回撤分析**：实时计算不同回撤水平下的资金损失
- **保证金计算**：基于30倍杠杆的保证金占用评估
- **仓位风险**：仓位放大倍数和风险等级量化
- **回本分析**：精确计算达到盈亏平衡所需的市场反转点数

### 📋 仓位构建详情
- **层级展示**：每层DCA仓位的详细信息
- **价格计算**：基于相对价格的入场价格计算
- **手数累计**：实时显示累计持仓手数变化
- **距离监控**：各层级距离起始点的点数统计

### 🎯 快速参数模板
- **保守型策略**：低风险配置，适合新手交易者
- **均衡型策略**：风险收益平衡，适合中级交易者
- **激进型策略**：高风险高收益，适合经验丰富的交易者

### 🔧 高级调试分析面板
- **模态框设计**：全屏覆盖模式，不受布局限制，充分利用显示空间
- **实时图表可视化**：基于ECharts的动态图表系统
  - 📊 **仓位构建分析图表**：直观展示各层DCA仓位分布和手数变化
  - 📈 **回撤风险曲线图表**：实时显示不同回撤水平下的浮动盈亏
  - 🖱️ **智能Tooltip信息卡片**：鼠标悬停显示完整的回撤分析详情
    - 💰 浮动盈亏（实时计算，颜色区分盈亏状态）
    - 📈 累计仓位（显示层数和总手数）
    - 🎯 距离回本（到达盈亏平衡所需点数）
    - 💵 累计投入、📊 平均成本、💎 当前价格
    - ⬇️ 下层触发价格、🛡️ 保证金占用
    - ⚠️ 智能风险等级评估
    - 📱 响应式设计（桌面/移动端自适应）
- **详细计算过程**：完整的参数计算步骤和中间结果追踪
- **公式验证系统**：数学公式验证和计算状态监控
- **交互优化**：
  - ⌨️ ESC键快速关闭
  - 🖱️ 点击遮罩关闭面板
  - 🔍 图表缩放和全屏功能
  - 📊 调试数据一键导出

## 🛠️ 技术架构

### 前端技术栈
- **Vue 3**：现代化响应式前端框架 + Composition API
- **ECharts 5.5.0**：专业图表可视化库，支持动态数据更新和交互式tooltip
- **响应式数据优化**：智能处理Vue3响应式系统与ECharts兼容性
- **模块化设计**：工具函数和业务逻辑分离
- **现代CSS**：CSS Grid + Flexbox 混合布局
- **响应式设计**：桌面/平板/手机多端适配

### 核心算法
- **DCA计算引擎**：基于数学模型的精确仓位计算
- **风险评估算法**：多维度风险指标量化分析
- **参数验证系统**：完整的输入参数有效性检查
- **性能优化**：计算结果缓存和状态管理优化

### 样式设计
- **现代化UI**：渐变背景和卡片式布局设计
- **模态框系统**：全屏覆盖调试面板，毛玻璃效果遮罩
- **动画效果**：流畅的渐入动画和滑入效果
- **响应式布局**：适配桌面和移动设备的网格系统
- **直观交互**：清晰的视觉层次和实时用户反馈
- **专业配色**：符合金融工具的专业视觉风格

## 🚀 快速开始

### 环境要求
- 现代浏览器（支持ES6+）
- 本地HTTP服务器（用于文件访问）

### 安装运行

1. **克隆仓库**
```bash
git clone https://github.com/YamaXanadu830/dca-calculator.git
cd dca-calculator
```

2. **启动本地服务器**
```bash
# 使用Python 3
python3 -m http.server 8080

# 或使用Python 2
python -m SimpleHTTPServer 8080

# 或使用Node.js
npx http-server -p 8080
```

3. **访问应用**
```
打开浏览器访问：http://localhost:8080
```

### 使用方法

1. **参数配置**
   - 输入DCA间距（建议5-50点）
   - 设置首次仓位手数（建议0.01-1.0）
   - 调整仓位倍数指数（建议1.0-2.0）
   - 限制最大仓位数（建议5-20层）

2. **风险评估**
   - 设置预期最大回撤点数
   - 配置每点价值（根据交易品种）
   - 点击"分析风险"按钮执行计算

3. **结果分析**
   - 查看关键风险指标
   - 分析仓位构建详情
   - 根据风险建议优化参数

4. **调试模式使用**
   - 点击"🔧 开启调试模式"按钮
   - 在模态框中查看详细图表分析
   - 使用ESC键或点击遮罩快速关闭
   - 支持图表缩放、全屏和数据导出

## 📁 项目结构

```
dca-calculator/
├── index.html              # 主页面文件
├── css/
│   └── main.css            # 主样式文件
├── js/
│   ├── app.js              # Vue应用主文件
│   └── utils/
│       └── calculations.js  # 计算工具函数
└── README.md               # 项目文档
```

### 核心文件说明

- **index.html**：应用主页面，完整UI结构 + 模态框调试面板
- **css/main.css**：1500+ 行现代化CSS，包含响应式模态框系统
- **js/app.js**：Vue 3应用逻辑，ECharts集成，模态框交互管理
- **js/utils/calculations.js**：DCA计算引擎，风险分析和调试信息生成

## 📈 核心算法说明

### DCA仓位计算
```javascript
// 每层仓位手数计算
positionVolume = firstVolume × volumeExponent^level

// 入场价格计算（相对参考价格）
entryPrice = referencePrice - (level × pipStep × 0.0001)
```

### 风险指标计算
- **最大可能亏损**：基于最大回撤点数和总持仓手数
- **回本所需点数**：根据平均成本价格和总投资计算
- **保证金占用**：按30倍杠杆计算保证金需求
- **仓位放大倍数**：最后一层与第一层仓位的倍数关系

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目！

### 开发规范
- 遵循Vue 3最佳实践
- 保持代码注释的中文化
- 确保计算精度和算法正确性
- 维护响应式设计兼容性

### 提交流程
1. Fork本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 📋 更新日志

### v1.2.0 (2025-08-30) - 界面优化重构版本
**🎯 用户体验重大优化：消除功能重复，简化界面层次**

#### ✨ 界面优化
- **消除重复信息**：删除右边栏底部重复的回撤风险分析汇总区域
- **优化信息层次**：最大亏损、回本点数等关键数据只在关键指标卡片中显示一次
- **新增导航按钮**：添加"📈 查看详细回撤分析"按钮，直接跳转到调试面板
- **界面简化**：主分析结果页面更加简洁，重点突出核心指标

#### 🎨 样式增强
- **导航按钮样式**：新增绿色渐变样式的分析导航按钮
- **响应式设计**：按钮支持hover动画和点击反馈效果
- **用户体验**：清晰的视觉层次，消除信息混乱

#### 🔧 技术改进
- **保持功能完整性**：所有计算逻辑和调试功能完全保留
- **零影响左侧**：参数配置区域完全不受影响
- **代码清理**：移除重复的HTML结构，优化代码组织

#### 📊 布局优化
- **主界面结构**：关键指标卡片 → 风险建议 → 仓位详情表格 → 导航按钮
- **调试面板保留**：完整的ECharts图表和交互功能不变
- **信息流优化**：用户可通过导航按钮方便地访问详细分析

### v1.1.0 (2024-12-31) - Tooltip功能增强
**🎯 重大功能更新：ECharts Tooltip交互式信息卡片**

#### ✨ 新增功能
- **智能Tooltip信息卡片**：鼠标悬停回撤风险曲线显示详细分析信息
- **9维度数据展示**：浮动盈亏、累计仓位、距离回本、平均成本等完整信息
- **响应式Tooltip设计**：桌面端和移动端自适应布局和字体大小
- **色彩编码系统**：盈亏状态和风险等级的直观颜色标识
- **智能定位算法**：移动端优化防止手指遮挡

#### 🔧 技术优化
- **Vue3兼容性修复**：解决响应式系统与ECharts 5.5.0的冲突问题
- **实例管理优化**：将ECharts实例存储从reactive()改为普通变量
- **数据嵌入架构**：优化tooltip数据传递方式，确保稳定访问
- **性能提升**：减少DOM操作和内存占用

#### 🐛 问题修复
- 修复tooltip不显示的根本问题
- 解决Vue3 Proxy干扰ECharts内部操作的兼容性问题  
- 优化图表初始化时序，确保实例正确创建

#### 📊 数据增强
- **实时计算**：动态显示当前回撤点的精确财务数据
- **风险评估**：智能风险等级判断（低/中/高风险）
- **保证金计算**：基于30倍杠杆的实时保证金占用
- **下层预测**：显示下一个DCA触发价格点位

### v1.0.0 (2024-12-30) - 初始版本
- 基础DCA参数计算功能
- Vue3 + ECharts图表可视化
- 响应式界面设计
- 调试面板和数据导出

## 🙋‍♂️ 联系作者

**YamaXanadu830**
- GitHub: [@YamaXanadu830](https://github.com/YamaXanadu830)
- 项目链接: [https://github.com/YamaXanadu830/dca-calculator](https://github.com/YamaXanadu830/dca-calculator)

---

⭐ 如果这个项目对你有帮助，请给它一个星标！